#include "TXLib.h"
#include <fstream>

using namespace std;

struct Forma
{
    string text_question;
    int right_answer;
    HDC pic_answer1;
    string text_answer1;
    HDC pic_answer2;
    string text_answer2;
    HDC pic_answer3;
    string text_answer3;
};

void drawAnswer(int x, HDC pic_answer, string text_answer)
{
    txSelectFont("Times New Roman", 40);
    txSetColor (TX_WHITE, 7);
    txRectangle (x, 320, x+200, 470);
    txBitBlt(txDC(), x, 320, 200, 150, pic_answer);
    txDrawText  (x, 500, x+200, 550, text_answer.c_str());
}

bool clickAnswer(int x)
{
    return(txMouseButtons()==1 && txMouseX()>x && txMouseX()<x+200 && txMouseY()>320 && txMouseY()<470);
}

int main()
{

setlocale(LC_ALL, "Russian");

txCreateWindow (800, 600);

    int kol_question;
    Forma quest_buf;
    Forma quest[20];
    int n_question = 1;
    int kol_right_answer = 0;
    char stroka[50];
    string str;

    ifstream file("Вопросы.txt");

    int n = 0;
    while(file.good())
    {
        getline(file, str);
        int pos2 = -1;
        int pos1 = pos2 + 1;

        pos2 = str.find(",", pos1);
        quest[n].text_question = str.substr(pos1, pos2-pos1);

        pos1 = pos2 + 1;
        pos2 = str.find(",", pos1);
        quest[n].right_answer = atoi((str.substr(pos1, pos2-pos1)).c_str());

        pos1 = pos2 + 1;
        pos2 = str.find(",", pos1);
        quest[n].pic_answer1 = txLoadImage((str.substr(pos1, pos2-pos1)).c_str());

        pos1 = pos2 + 1;
        pos2 = str.find(",", pos1);
        quest[n].text_answer1 = str.substr(pos1, pos2-pos1);

        pos1 = pos2 + 1;
        pos2 = str.find(",", pos1);
        quest[n].pic_answer2 = txLoadImage((str.substr(pos1, pos2-pos1)).c_str());

        pos1 = pos2 + 1;
        pos2 = str.find(",", pos1);
        quest[n].text_answer2 = str.substr(pos1, pos2-pos1);


        pos2 = str.find(",", pos1);
        quest[n].pic_answer3 = txLoadImage((str.substr(pos1, pos2-pos1)).c_str());

        pos2 = str.find(",", pos1);
        quest[n].text_answer3 = str.substr(pos1, pos2-pos1);

        n++;
    }

    kol_question = n;

    while(n_question <= kol_question)
    {
        txSetColor (TX_BLACK);
        txSetFillColor (TX_BLACK);
        txClear();
        txBegin();

        quest_buf = quest[n_question - 1];

        //ШАБЛОН
        txSetColor (TX_WHITE, 1);
        txSetFillColor (TX_TRANSPARENT);
        txRectangle (10, 10, 790, 590);
        //Номер и количество вопросов
        sprintf(stroka, "Вопрос %d/%d", n_question, kol_question);
        txDrawText(0, 20, 800, 50, stroka);
        //Вопрос
        txSelectFont("Times New Roman", 60);
        txDrawText(0, 0, 800, 200, quest_buf.text_question.c_str());
        //Ответы
        drawAnswer( 50, quest_buf.pic_answer1, quest_buf.text_answer1);
        drawAnswer(300, quest_buf.pic_answer2, quest_buf.text_answer2);
        drawAnswer(550, quest_buf.pic_answer3, quest_buf.text_answer3);

        if(clickAnswer(50))
        {
            if(quest_buf.right_answer == 1) kol_right_answer ++;
            txSleep(200);
            n_question++;
        }

        if(clickAnswer(300))
        {
            if(quest_buf.right_answer == 2) kol_right_answer ++;
            txSleep(200);
            n_question++;
        }

        if(clickAnswer(550))
        {
            if(quest_buf.right_answer == 3) kol_right_answer ++;
            txSleep(200);
            n_question++;
        }
        txEnd();
        txSleep(20);
    }

    txSetColor (TX_WHITE);
    txSetFillColor (TX_BLACK);
    txClear();
    txDrawText(0, 0, 800, 400, "РЕЗУЛЬТАТ");
    sprintf(stroka, "Количество правильных ответов %d", kol_right_answer);
    txDrawText(0, 0, 800, 600, stroka);

    txDeleteDC (quest_buf.pic_answer1);
    txDeleteDC (quest_buf.pic_answer2);
    txDeleteDC (quest_buf.pic_answer3);

txTextCursor (false);
return 0;
}
